<% @title = "Training Grant Overview" %>
<h1><%= @title %></h1>

<div class="frame">
  <table class="padded" style="background-color:transparent;border:0px">
    <tr>
      <td style="vertical-align:bottom;border:0px">
        <table class="padded">
          <tr>
            <td style="font-weight:bold">Outstanding Data Requests</td>
            <td></td>
          </tr>
          <tr>
            <td style="font-weight:bold">Pending Applications</td>
            <td>
              <% pending_applications = Applicant.current.where(reviewed: false) %>
              <%= pending_applications.count %>
            </td>
          </tr>
          <tr>
            <td style="padding-left:20px">Postdoc</td>
            <td><%= pending_applications.where(applicant_type: 'postdoc').count %></td>
          </tr>
          <tr>
            <td style="padding-left:20px">Predoc</td>
            <td><%= pending_applications.where(applicant_type: 'predoc').count %></td>
          </tr>
          <tr>
            <td style="padding-left:20px">Summer</td>
            <td><%= pending_applications.where(summer: true).count %></td>
          </tr>
          <tr>
            <td style="font-weight:bold">Applications this calendar year</td>
            <td>
              <% year_applicants = Applicant.current.where(submitted_at: Time.now.at_beginning_of_year..Time.now.at_end_of_year) %>
              <%= year_applicants.count %>
            </td>
          </tr>
          <tr>
            <td style="padding-left:20px">Postdoc</td>
            <td><%= year_applicants.where(applicant_type: 'postdoc').count %></td>
          </tr>
          <tr>
            <td style="padding-left:20px">Predoc</td>
            <td><%= year_applicants.where(applicant_type: 'predoc').count %></td>
          </tr>
          <tr>
            <td style="padding-left:20px">Summer</td>
            <td><%= year_applicants.where(summer: true).count %></td>
          </tr>
          <tr>
            <td style="font-weight:bold">Acceptance rate this calendar year</td>
            <td><%= year_applicants.count == 0 ? 'N/A' : "%0.00f %" % (year_applicants.where(accepted: true).count * 100.0 / year_applicants.count) %></td>
          </tr>
        </table>
      </td>
      <td style="vertical-align:bottom;border:0px">
        <table class="padded">
          <tr>
            <td style="font-weight:bold">Applications last calendar year</td>
            <td>
              <% last_year_applicants = Applicant.current.where(submitted_at: (Time.now - 1.year).at_beginning_of_year..(Time.now - 1.year).at_end_of_year) %>
              <%= last_year_applicants.count %>
            </td>
          </tr>
          <tr>
            <td style="padding-left:20px">Postdoc</td>
            <td><%= last_year_applicants.where(applicant_type: 'postdoc').count %></td>
          </tr>
          <tr>
            <td style="padding-left:20px">Predoc</td>
            <td><%= last_year_applicants.where(applicant_type: 'predoc').count %></td>
          </tr>
          <tr>
            <td style="padding-left:20px">Summer</td>
            <td><%= last_year_applicants.where(summer: true).count %></td>
          </tr>
          <tr>
            <td style="font-weight:bold">Acceptance rate last calendar year</td>
            <td><%= last_year_applicants.count == 0 ? 'N/A' : "%0.00f %" % (last_year_applicants.where(accepted: true).count * 100.0 / last_year_applicants.count) %></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</div>
